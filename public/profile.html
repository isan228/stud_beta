<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="theme-color" content="#2563eb">
    <title>–ü—Ä–æ—Ñ–∏–ª—å - stud.kg</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <a href="/">
                    <h1>stud.kg</h1>
                </a>
            </div>
            <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="–ú–µ–Ω—é">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <div class="nav-menu" id="navMenu">
                <a href="/" class="nav-link">–ì–ª–∞–≤–Ω–∞—è</a>
                <a href="/tests" class="nav-link">–¢–µ—Å—Ç—ã</a>
                <a href="/news" class="nav-link">–ù–æ–≤–æ—Å—Ç–∏</a>
                <a href="/about" class="nav-link">–û –Ω–∞—Å</a>
                <a href="/favorites" class="nav-link" id="favoritesLink">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</a>
                <a href="/profile" class="nav-link" id="profileLink">–ü—Ä–æ—Ñ–∏–ª—å</a>
                <a href="/contact" class="nav-link">–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å</a>
                <div class="nav-actions">
                    <button class="theme-toggle" id="themeToggle" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
                        <span class="theme-icon">üåô</span>
                    </button>
                    <a href="/login" class="btn btn-primary" id="loginBtn" style="display: none;">–í–æ–π—Ç–∏</a>
                    <a href="/register" class="btn btn-secondary" id="registerBtn"
                        style="display: none;">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
                    <button class="btn btn-logout" id="logoutBtn">–í—ã—Ö–æ–¥</button>
                </div>
            </div>
        </div>
    </nav>

    <main class="main-content">
        <div class="container">
            <div class="page-header">
                <h1>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h1>
                <p class="page-description">
                    –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —Å–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å, –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –º–æ—Ç–∏–≤–∞—Ü–∏—é
                    —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É —Å—Ç—Ä–∏–∫–æ–≤ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –∑–∞–Ω—è—Ç–∏–π.
                </p>
            </div>
            <div class="profile-content">
                <div class="user-info-card">
                    <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ</h3>
                    <div class="user-details" id="userDetails">
                        <p><strong>–ù–∏–∫–Ω–µ–π–º:</strong> <span id="userUsername">-</span></p>
                        <p><strong>Email:</strong> <span id="userEmail">-</span></p>
                        <p><strong>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:</strong> <span id="userCreatedAt">-</span></p>
                        <p><strong>–ë–∞–ª–∞–Ω—Å –º–æ–Ω–µ—Ç–æ–∫:</strong> <span id="userCoins"
                                style="color: var(--primary-color); font-weight: 600;">0</span> ü™ô</p>
                        <p><strong>–ü–æ–¥–ø–∏—Å–∫–∞ –¥–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ:</strong> <span id="userSubscriptionEnd"
                                style="color: var(--primary-color); font-weight: 600;">-</span> <button
                                id="renewSubscriptionBtn" class="btn btn-sm btn-primary"
                                style="display: none; margin-left: 10px; padding: 0.25rem 0.75rem; font-size: 0.8rem;"
                                onclick="renewSubscription()">–ü—Ä–æ–¥–ª–∏—Ç—å</button></p>
                    </div>
                </div>
                <div class="settings-card">
                    <h3>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</h3>
                    <div class="settings-content">
                        <div class="form-group">
                            <label for="referralLink">–í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞</label>
                            <div style="display: flex; gap: 0.5rem; align-items: center;">
                                <input type="text" id="referralLink" readonly
                                    style="flex: 1; background: var(--bg-secondary); cursor: text;" value="">
                                <button class="btn btn-secondary" id="copyReferralLink"
                                    style="min-width: auto; padding: 0.75rem 1rem;">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                            </div>
                            <small>–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —ç—Ç–æ–π —Å—Å—ã–ª–∫–æ–π —Å –¥—Ä—É–∑—å—è–º–∏. –ó–∞ –∫–∞–∂–¥–æ–≥–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥—Ä—É–≥–∞ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ
                                50 –º–æ–Ω–µ—Ç–æ–∫, –∞ –≤–∞—à –¥—Ä—É–≥ —Ç–æ–∂–µ –ø–æ–ª—É—á–∏—Ç 50 –º–æ–Ω–µ—Ç–æ–∫ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏!</small>
                        </div>
                        <div
                            style="margin-top: 1rem; padding: 1rem; background: var(--bg-secondary); border-radius: var(--radius); border-left: 4px solid var(--primary-color);">
                            <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;">
                                <strong style="color: var(--text-color);">–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:</strong><br>
                                ‚Ä¢ –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –¥—Ä—É–≥—É<br>
                                ‚Ä¢ –î—Ä—É–≥ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –ø–æ –≤–∞—à–µ–π —Å—Å—ã–ª–∫–µ –∏ –ø–æ–∫—É–ø–∞–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É<br>
                                ‚Ä¢ –í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ <strong style="color: var(--success-color);">50 –º–æ–Ω–µ—Ç–æ–∫</strong> ü™ô<br>
                                ‚Ä¢ –î—Ä—É–≥ –ø–æ–ª—É—á–∞–µ—Ç <strong style="color: var(--success-color);">50 –º–æ–Ω–µ—Ç–æ–∫</strong> ü™ô
                            </p>
                        </div>
                    </div>
                </div>
                <div class="stats-card">
                    <h3>–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="statTests">0</div>
                            <div class="stat-label">–¢–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ</div>
                            <div class="stat-description">–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="statQuestions">0</div>
                            <div class="stat-label">–í–æ–ø—Ä–æ—Å–æ–≤ –æ—Ç–≤–µ—á–µ–Ω–æ</div>
                            <div class="stat-description">–í—Å–µ–≥–æ –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="statAccuracy">0%</div>
                            <div class="stat-label">–¢–æ—á–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–æ–≤</div>
                            <div class="stat-description">–ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="statStreak">0</div>
                            <div class="stat-label">–¢–µ–∫—É—â–∏–π —Å—Ç—Ä–∏–∫</div>
                            <div class="stat-description">–î–Ω–µ–π –ø–æ–¥—Ä—è–¥ —Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="statLongestStreak">0</div>
                            <div class="stat-label">–õ—É—á—à–∏–π —Å—Ç—Ä–∏–∫</div>
                            <div class="stat-description">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–µ—Ä–∏—è –¥–Ω–µ–π</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="statTimeSpent">0 —á</div>
                            <div class="stat-label">–í—Ä–µ–º—è –≤ —Ç–µ—Å—Ç–∞—Ö</div>
                            <div class="stat-description">–û–±—â–µ–µ –≤—Ä–µ–º—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤</div>
                        </div>
                    </div>
                </div>
                <div class="settings-card">
                    <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è</h3>
                    <div class="settings-content">
                        <form id="changePasswordForm" class="password-form">
                            <div class="form-group">
                                <label for="currentPassword">–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å</label>
                                <input type="password" id="currentPassword" name="currentPassword" required>
                            </div>
                            <div class="form-group">
                                <label for="newPassword">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                                <input type="password" id="newPassword" name="newPassword" required minlength="6">
                                <small>–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤</small>
                            </div>
                            <div class="form-group">
                                <label for="confirmNewPassword">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                                <input type="password" id="confirmNewPassword" name="confirmNewPassword" required
                                    minlength="6">
                            </div>
                            <button type="submit" class="btn btn-primary">–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
                        </form>
                    </div>
                </div>
                <div class="recent-results">
                    <h3>–ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–π</h3>
                    <p class="section-description">–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–∞—à–∏—Ö —Ç–µ—Å—Ç–æ–≤</p>
                    <div id="recentResultsList"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ–¥–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ -->
    <div id="renewalModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <span class="close" id="renewalModalClose">&times;</span>
            <h2 style="margin-bottom: 1.5rem; text-align: center;">–ü—Ä–æ–¥–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏</h2>

            <div class="subscription-plans">
                <div class="plan-card selected" data-months="1" data-price="100" onclick="selectPlan(this)">
                    <div class="plan-header">
                        <span class="plan-name">1 –ú–µ—Å—è—Ü</span>
                        <span class="plan-price">100 —Å–æ–º</span>
                    </div>
                </div>

                <div class="plan-card" data-months="2" data-price="200" onclick="selectPlan(this)">
                    <div class="plan-header">
                        <span class="plan-name">2 –ú–µ—Å—è—Ü–∞</span>
                        <span class="plan-price">200 —Å–æ–º</span>
                    </div>
                </div>

                <div class="plan-card" data-months="3" data-price="300" onclick="selectPlan(this)">
                    <div class="plan-header">
                        <span class="plan-name">3 –ú–µ—Å—è—Ü–∞</span>
                        <span class="plan-price">300 —Å–æ–º</span>
                    </div>
                </div>
            </div>

            <div class="total-section"
                style="margin: 2rem 0; padding-top: 1rem; border-top: 1px solid var(--border-light); display: flex; justify-content: space-between; align-items: center;">
                <span style="font-size: 1.1rem; color: var(--text-secondary);">–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ:</span>
                <span id="totalPrice" style="font-size: 1.5rem; font-weight: 700; color: var(--primary-color);">100
                    —Å–æ–º</span>
            </div>

            <button class="btn btn-primary btn-block btn-large" onclick="proceedToPayment()">–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–∞–∑–±–æ—Ä–∞ —Ç–µ—Å—Ç–∞ -->
    <div id="testAnalysisModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
            <span class="modal-close" id="testAnalysisModalClose">&times;</span>
            <h2 id="testAnalysisTitle">–†–∞–∑–±–æ—Ä —Ç–µ—Å—Ç–∞</h2>
            <div id="testAnalysisContent">
                <div style="text-align: center; padding: 2rem;">
                    <div class="spinner"
                        style="border: 4px solid var(--bg-secondary); border-top: 4px solid var(--primary-color); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto;">
                    </div>
                    <p style="margin-top: 1rem; color: var(--text-secondary);">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞–∑–±–æ—Ä–∞...</p>
                </div>
            </div>
        </div>
    </div>

    <style>
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .test-analysis-item {
            margin: 1.5rem 0;
            padding: 1.5rem;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-light);
            background: var(--bg-secondary);
        }

        .test-analysis-item.correct {
            border-left: 4px solid var(--success-color);
            background: linear-gradient(90deg, rgba(16, 185, 129, 0.05) 0%, var(--bg-secondary) 4%);
        }

        .test-analysis-item.incorrect {
            border-left: 4px solid var(--danger-color);
            background: linear-gradient(90deg, rgba(220, 38, 38, 0.05) 0%, var(--bg-secondary) 4%);
        }

        .test-analysis-question {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: var(--text-color);
        }

        .test-analysis-answer {
            padding: 0.75rem 1rem;
            margin: 0.5rem 0;
            border-radius: var(--radius);
            background: var(--card-bg);
        }

        .test-analysis-answer.user-answer {
            border: 2px solid var(--danger-color);
            background: rgba(220, 38, 38, 0.1);
        }

        .test-analysis-answer.correct-answer {
            border: 2px solid var(--success-color);
            background: rgba(16, 185, 129, 0.1);
        }

        .test-analysis-label {
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
        }
    </style>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>stud.kg</h3>
                    <p>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ —ç–∫–∑–∞–º–µ–Ω–∞–º</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 stud.kg. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
            </div>
        </div>
    </footer>

    <div id="notification" class="notification"></div>
    <script src="app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            initTheme();
            setupEventListeners();

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = '/login';
                return;
            }

            currentToken = token;
            if (typeof window.fetchUser === 'function') {
                await window.fetchUser();
            } else {
                console.error('fetchUser –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                window.location.href = '/login';
                return;
            }

            if (!window.currentUser) {
                window.location.href = '/login';
                return;
            }

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            if (typeof window.loadProfile === 'function') {
                await window.loadProfile();
            } else {
                console.error('loadProfile –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
            }

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è
            const changePasswordForm = document.getElementById('changePasswordForm');
            if (changePasswordForm) {
                changePasswordForm.addEventListener('submit', handleChangePassword);
            }
        });
    </script>
</body>

</html>