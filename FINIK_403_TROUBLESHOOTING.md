# –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã 403 Forbidden –æ—Ç Finik API

## –°–∏–º–ø—Ç–æ–º—ã

```
Finik API Error: {
  status: 403,
  statusText: 'Forbidden',
  error: { message: 'Forbidden' }
}
```

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### 1. –ù–µ–≤–µ—Ä–Ω—ã–π API Key

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cat .env | grep FINIK_API_KEY
```

**–†–µ—à–µ–Ω–∏–µ:**
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ API Key –ø–æ–ª—É—á–µ–Ω –æ—Ç Finik
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–ª—é—á —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é (–±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤ –≤ –Ω–∞—á–∞–ª–µ/–∫–æ–Ω—Ü–µ)
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–ª—é—á –¥–ª—è –æ–∫—Ä—É–∂–µ–Ω–∏—è (beta/prod)

### 2. –ù–µ–≤–µ—Ä–Ω–∞—è –ø–æ–¥–ø–∏—Å—å

**–ü—Ä–∏—á–∏–Ω—ã:**
- –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—É–±–ª–∏—á–Ω–æ–º—É –∫–ª—é—á—É, –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–º—É –≤ Finik
- –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞
- –ü—Ä–æ–±–ª–µ–º–∞ —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –ø–æ–¥–ø–∏—Å–∏

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞
head -1 finik_private.pem
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: -----BEGIN PRIVATE KEY----- –∏–ª–∏ -----BEGIN RSA PRIVATE KEY-----

tail -1 finik_private.pem
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: -----END PRIVATE KEY----- –∏–ª–∏ -----END RSA PRIVATE KEY-----

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–ª—é—á –Ω–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω
openssl rsa -in finik_private.pem -check -noout
```

**–†–µ—à–µ–Ω–∏–µ:**
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á (`finik_public.pem`) –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ Finik
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á
- –ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∫–ª—é—á–∏, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ:
  ```bash
  openssl genrsa -out finik_private.pem 2048
  openssl rsa -in finik_private.pem -pubout > finik_public.pem
  ```
- –û—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –≤ Finik

### 3. –ù–µ–≤–µ—Ä–Ω—ã–π Host –∑–∞–≥–æ–ª–æ–≤–æ–∫

**–ü—Ä–æ–±–ª–µ–º–∞:** Host –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–æ–ª–∂–µ–Ω —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –¥–æ–º–µ–Ω–æ–º –≤ URL.

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ª–æ–≥–∞—Ö:**
–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞ –≤ –ª–æ–≥–∞—Ö –±—É–¥–µ—Ç –≤–∏–¥–Ω–æ:
```
üîê Finik Payment Request Details: {
  host: 'beta.api.acquiring.averspay.kg',
  url: 'https://beta.api.acquiring.averspay.kg/v1/payment',
  ...
}
```

**–†–µ—à–µ–Ω–∏–µ:**
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Host —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –¥–æ–º–µ–Ω–æ–º URL
- –î–ª—è beta: `beta.api.acquiring.averspay.kg`
- –î–ª—è prod: `api.acquiring.averspay.kg`

### 4. –ù–µ–≤–µ—Ä–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è beta –æ–∫—Ä—É–∂–µ–Ω–∏–µ, –Ω–æ –∫–ª—é—á–∏ –¥–ª—è prod (–∏–ª–∏ –Ω–∞–æ–±–æ—Ä–æ—Ç).

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
cat .env | grep FINIK_ENV
```

**–†–µ—à–µ–Ω–∏–µ:**
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `FINIK_ENV` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤–∞—à–µ–º—É –æ–∫—Ä—É–∂–µ–Ω–∏—é
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–ª—é—á–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### 5. –ü—Ä–æ–±–ª–µ–º–∞ —Å —Ñ–æ—Ä–º–∞—Ç–æ–º –∑–∞–ø—Ä–æ—Å–∞

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ª–æ–≥–∞—Ö:**
–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞ –±—É–¥—É—Ç –≤–∏–¥–Ω—ã –¥–µ—Ç–∞–ª–∏ –∑–∞–ø—Ä–æ—Å–∞.

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç body –∑–∞–ø—Ä–æ—Å–∞
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ JSON –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω

## –ü–æ—à–∞–≥–æ–≤–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

```bash
cd ~/stud_beta
git pull origin main
pm2 restart stud-kg

# –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç–µ–∂ –∏ —Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏
pm2 logs stud-kg --lines 0
```

–í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å:
- `‚úÖ Configuration loaded:` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- `üîê Finik Payment Request Details:` - –¥–µ—Ç–∞–ª–∏ –∑–∞–ø—Ä–æ—Å–∞
- `üìù Canonical string length:` - –¥–ª–∏–Ω–∞ —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –ø–æ–¥–ø–∏—Å–∏

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
cat .env | grep FINIK

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª—é—á–∏
ls -la finik_*.pem
head -1 finik_private.pem
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Finik API

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API
curl -I https://beta.api.acquiring.averspay.kg/v1/payment
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å 405 Method Not Allowed (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è GET)
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–ø–∏—Å—å –≤—Ä—É—á–Ω—É—é

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å—å:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Node.js REPL
node

# –í REPL:
const { Signer } = require('@mancho.devs/authorizer');
const fs = require('fs');
const privateKey = fs.readFileSync('finik_private.pem', 'utf8');

const requestData = {
  httpMethod: 'POST',
  path: '/v1/payment',
  headers: {
    Host: 'beta.api.acquiring.averspay.kg',
    'x-api-key': 'your_api_key',
    'x-api-timestamp': Date.now().toString()
  },
  queryStringParameters: undefined,
  body: { Amount: 100, CardType: 'FINIK_QR', PaymentId: 'test' }
};

const signer = new Signer(requestData);
const signature = await signer.sign(privateKey);
console.log('Signature:', signature);
```

## –ö–æ–Ω—Ç–∞–∫—Ç—ã —Å Finik

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–∞–µ—Ç—Å—è, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É Finik —Å:
1. –õ–æ–≥–∞–º–∏ –∑–∞–ø—Ä–æ—Å–∞ (–∏–∑ `üîê Finik Payment Request Details`)
2. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± –æ–∫—Ä—É–∂–µ–Ω–∏–∏ (beta/prod)
3. Account ID
4. –ü—Ä–∏–º–µ—Ä–æ–º –∑–∞–ø—Ä–æ—Å–∞ (–±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –∫–ª—é—á–µ–π)

## –ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏

- [ ] API Key —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
- [ ] –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
- [ ] –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ Finik
- [ ] Host –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å URL
- [ ] –û–∫—Ä—É–∂–µ–Ω–∏–µ (beta/prod) –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- [ ] Account ID –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
- [ ] –í—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –≤ –∑–∞–ø—Ä–æ—Å–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç
- [ ] –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –¥–µ—Ç–∞–ª–∏ –∑–∞–ø—Ä–æ—Å–∞

